<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>SpringDataJpa快速入门 | LiuYuBLOG</title><meta name="description" content="Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。"><meta name="keywords" content="SpringDataJpa"><meta name="author" content="LiuYu"><meta name="copyright" content="LiuYu"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="SpringDataJpa快速入门"><meta name="twitter:description" content="Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/springdatajpa.jpg"><meta property="og:type" content="article"><meta property="og:title" content="SpringDataJpa快速入门"><meta property="og:url" content="https://www.liuyu.pw/posts/cdeb19ab"><meta property="og:site_name" content="LiuYuBLOG"><meta property="og:description" content="Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/springdatajpa.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.css"><link rel="canonical" href="https://www.liuyu.pw/posts/cdeb19ab"><link rel="prev" title="Oracle把查询结果插入到表中几种方式" href="https://www.liuyu.pw/posts/1f9a4005.html"><link rel="next" title="Oracle入门" href="https://www.liuyu.pw/posts/9f698189.html"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"363T1ONDPV","apiKey":"0bf0472e16364a75b7fabf468c769662","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.liuyu.pw/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: 'true',
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"}
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">LiuYuBLOG</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/avatar-20191105100332.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第1章-Spring-Data-JPA的概述"><span class="toc_mobile_items-text">第1章    Spring Data JPA的概述</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-1-Spring-Data-JPA概述"><span class="toc_mobile_items-text">1.1    Spring Data JPA概述</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-2-Spring-Data-JPA的特性"><span class="toc_mobile_items-text">1.2    Spring Data JPA的特性</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-3-Spring-Data-JPA-与-JPA和hibernate之间的关系"><span class="toc_mobile_items-text">1.3    Spring Data JPA 与 JPA和hibernate之间的关系</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第2章-Spring-Data-JPA的快速入门"><span class="toc_mobile_items-text">第2章    Spring Data JPA的快速入门</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-1-需求说明"><span class="toc_mobile_items-text">2.1    需求说明</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-2-搭建Spring-Data-JPA的开发环境"><span class="toc_mobile_items-text">2.2    搭建Spring Data JPA的开发环境</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-2-1-引入Spring-Data-JPA的坐标"><span class="toc_mobile_items-text">2.2.1    引入Spring Data JPA的坐标</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-2-2-整合Spring-Data-JPA与Spring"><span class="toc_mobile_items-text">2.2.2    整合Spring Data JPA与Spring</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-2-3-使用JPA注解配置映射关系"><span class="toc_mobile_items-text">2.2.3    使用JPA注解配置映射关系</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-3-使用Spring-Data-JPA完成需求"><span class="toc_mobile_items-text">2.3    使用Spring Data JPA完成需求</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-3-1-编写符合Spring-Data-JPA规范的Dao层接口"><span class="toc_mobile_items-text">2.3.1    编写符合Spring Data JPA规范的Dao层接口</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-3-2-完成基本CRUD操作"><span class="toc_mobile_items-text">2.3.2    完成基本CRUD操作</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第3章-Spring-Data-JPA的内部原理剖析"><span class="toc_mobile_items-text">第3章    Spring Data JPA的内部原理剖析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-1-Spring-Data-JPA的常用接口分析"><span class="toc_mobile_items-text">3.1    Spring Data JPA的常用接口分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-2-Spring-Data-JPA的实现过程"><span class="toc_mobile_items-text">3.2    Spring Data JPA的实现过程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-3-Spring-Data-JPA完整的调用过程分析"><span class="toc_mobile_items-text">3.3    Spring Data JPA完整的调用过程分析</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第4章-Spring-Data-JPA的查询方式"><span class="toc_mobile_items-text">第4章    Spring Data JPA的查询方式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-1-使用Spring-Data-JPA中接口定义的方法进行查询"><span class="toc_mobile_items-text">4.1    使用Spring Data JPA中接口定义的方法进行查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-2-使用JPQL的方式查询"><span class="toc_mobile_items-text">4.2    使用JPQL的方式查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-3-使用SQL语句查询"><span class="toc_mobile_items-text">4.3    使用SQL语句查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-4-方法命名规则查询"><span class="toc_mobile_items-text">4.4    方法命名规则查询</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第5章-Specifications动态查询"><span class="toc_mobile_items-text">第5章    Specifications动态查询</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-1-使用Specifications完成条件查询"><span class="toc_mobile_items-text">5.1    使用Specifications完成条件查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-2-基于Specifications的分页查询"><span class="toc_mobile_items-text">5.2    基于Specifications的分页查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-3-方法对应关系"><span class="toc_mobile_items-text">5.3    方法对应关系</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第6章-多表设计"><span class="toc_mobile_items-text">第6章    多表设计</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-1-表之间关系的划分"><span class="toc_mobile_items-text">6.1    表之间关系的划分</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-2-在JPA框架中表关系的分析步骤"><span class="toc_mobile_items-text">6.2    在JPA框架中表关系的分析步骤</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#第一步：首先确定两张表之间的关系。"><span class="toc_mobile_items-text">第一步：首先确定两张表之间的关系。</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#第二步：在数据库中实现两张表的关系"><span class="toc_mobile_items-text">第二步：在数据库中实现两张表的关系</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#第三步：在实体类中描述出两个实体的关系"><span class="toc_mobile_items-text">第三步：在实体类中描述出两个实体的关系</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#第四步：配置出实体类和数据库表的关系映射（重点）"><span class="toc_mobile_items-text">第四步：配置出实体类和数据库表的关系映射（重点）</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第7章-JPA中的一对多"><span class="toc_mobile_items-text">第7章    JPA中的一对多</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-1-示例分析"><span class="toc_mobile_items-text">7.1    示例分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-2-表关系建立"><span class="toc_mobile_items-text">7.2    表关系建立</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-3-实体类关系建立以及映射配置"><span class="toc_mobile_items-text">7.3    实体类关系建立以及映射配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-4-映射的注解说明"><span class="toc_mobile_items-text">7.4    映射的注解说明</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-5-一对多的操作"><span class="toc_mobile_items-text">7.5    一对多的操作</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-5-1-添加"><span class="toc_mobile_items-text">7.5.1    添加</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-5-2-删除"><span class="toc_mobile_items-text">7.5.2    删除</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-5-3-级联操作"><span class="toc_mobile_items-text">7.5.3    级联操作</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#第8章-JPA中的多对多"><span class="toc_mobile_items-text">第8章    JPA中的多对多</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#8-1-示例分析"><span class="toc_mobile_items-text">8.1    示例分析</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#8-2-表关系建立"><span class="toc_mobile_items-text">8.2    表关系建立</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#8-3-实体类关系建立以及映射配置"><span class="toc_mobile_items-text">8.3    实体类关系建立以及映射配置</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#第1章-Spring-Data-JPA的概述"><span class="toc-text">第1章    Spring Data JPA的概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Spring-Data-JPA概述"><span class="toc-text">1.1    Spring Data JPA概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Spring-Data-JPA的特性"><span class="toc-text">1.2    Spring Data JPA的特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Spring-Data-JPA-与-JPA和hibernate之间的关系"><span class="toc-text">1.3    Spring Data JPA 与 JPA和hibernate之间的关系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第2章-Spring-Data-JPA的快速入门"><span class="toc-text">第2章    Spring Data JPA的快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-需求说明"><span class="toc-text">2.1    需求说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-搭建Spring-Data-JPA的开发环境"><span class="toc-text">2.2    搭建Spring Data JPA的开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-引入Spring-Data-JPA的坐标"><span class="toc-text">2.2.1    引入Spring Data JPA的坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-整合Spring-Data-JPA与Spring"><span class="toc-text">2.2.2    整合Spring Data JPA与Spring</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-使用JPA注解配置映射关系"><span class="toc-text">2.2.3    使用JPA注解配置映射关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-使用Spring-Data-JPA完成需求"><span class="toc-text">2.3    使用Spring Data JPA完成需求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-编写符合Spring-Data-JPA规范的Dao层接口"><span class="toc-text">2.3.1    编写符合Spring Data JPA规范的Dao层接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-完成基本CRUD操作"><span class="toc-text">2.3.2    完成基本CRUD操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第3章-Spring-Data-JPA的内部原理剖析"><span class="toc-text">第3章    Spring Data JPA的内部原理剖析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Spring-Data-JPA的常用接口分析"><span class="toc-text">3.1    Spring Data JPA的常用接口分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Spring-Data-JPA的实现过程"><span class="toc-text">3.2    Spring Data JPA的实现过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Spring-Data-JPA完整的调用过程分析"><span class="toc-text">3.3    Spring Data JPA完整的调用过程分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第4章-Spring-Data-JPA的查询方式"><span class="toc-text">第4章    Spring Data JPA的查询方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-使用Spring-Data-JPA中接口定义的方法进行查询"><span class="toc-text">4.1    使用Spring Data JPA中接口定义的方法进行查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-使用JPQL的方式查询"><span class="toc-text">4.2    使用JPQL的方式查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-使用SQL语句查询"><span class="toc-text">4.3    使用SQL语句查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-方法命名规则查询"><span class="toc-text">4.4    方法命名规则查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第5章-Specifications动态查询"><span class="toc-text">第5章    Specifications动态查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-使用Specifications完成条件查询"><span class="toc-text">5.1    使用Specifications完成条件查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-基于Specifications的分页查询"><span class="toc-text">5.2    基于Specifications的分页查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-方法对应关系"><span class="toc-text">5.3    方法对应关系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第6章-多表设计"><span class="toc-text">第6章    多表设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-表之间关系的划分"><span class="toc-text">6.1    表之间关系的划分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-在JPA框架中表关系的分析步骤"><span class="toc-text">6.2    在JPA框架中表关系的分析步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步：首先确定两张表之间的关系。"><span class="toc-text">第一步：首先确定两张表之间的关系。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步：在数据库中实现两张表的关系"><span class="toc-text">第二步：在数据库中实现两张表的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步：在实体类中描述出两个实体的关系"><span class="toc-text">第三步：在实体类中描述出两个实体的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第四步：配置出实体类和数据库表的关系映射（重点）"><span class="toc-text">第四步：配置出实体类和数据库表的关系映射（重点）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第7章-JPA中的一对多"><span class="toc-text">第7章    JPA中的一对多</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-示例分析"><span class="toc-text">7.1    示例分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-表关系建立"><span class="toc-text">7.2    表关系建立</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-实体类关系建立以及映射配置"><span class="toc-text">7.3    实体类关系建立以及映射配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-映射的注解说明"><span class="toc-text">7.4    映射的注解说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-一对多的操作"><span class="toc-text">7.5    一对多的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1-添加"><span class="toc-text">7.5.1    添加</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-2-删除"><span class="toc-text">7.5.2    删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-3-级联操作"><span class="toc-text">7.5.3    级联操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第8章-JPA中的多对多"><span class="toc-text">第8章    JPA中的多对多</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-示例分析"><span class="toc-text">8.1    示例分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-表关系建立"><span class="toc-text">8.2    表关系建立</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-实体类关系建立以及映射配置"><span class="toc-text">8.3    实体类关系建立以及映射配置</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/springdatajpa.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">SpringDataJpa快速入门</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-07-23<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-11-27</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SpringDataJpa/">SpringDataJpa</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon" aria-hidden="true"></i><span>字数总计: </span><span class="word-count">9.9k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon" aria-hidden="true"></i><span>阅读时长: 40 分钟</span><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="第1章-Spring-Data-JPA的概述"><a href="#第1章-Spring-Data-JPA的概述" class="headerlink" title="第1章    Spring Data JPA的概述"></a>第1章    Spring Data JPA的概述</h1><h2 id="1-1-Spring-Data-JPA概述"><a href="#1-1-Spring-Data-JPA概述" class="headerlink" title="1.1    Spring Data JPA概述"></a>1.1    Spring Data JPA概述</h2><p><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/1.jpg" class="lazyload"></p>
<p>Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。它提供了包括增删改查等在内的常用功能，且易于扩展！学习并使用 Spring Data JPA 可以极大提高开发效率！<br><code>Spring Data JPA 让我们解脱了DAO层的操作，基本上所有CRUD都可以依赖于它来实现,在实际的工作工程中，推荐使用Spring Data JPA + ORM（如：hibernate）完成操作，这样在切换不同的ORM框架时提供了极大的方便，同时也使数据库层操作更加简单，方便解耦</code></p>
<h2 id="1-2-Spring-Data-JPA的特性"><a href="#1-2-Spring-Data-JPA的特性" class="headerlink" title="1.2    Spring Data JPA的特性"></a>1.2    Spring Data JPA的特性</h2><p><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/2.jpg" class="lazyload"><br><code>SpringData Jpa 极大简化了数据库访问层代码。 如何简化的呢？ 使用了SpringDataJpa，我们的dao层中只需要写接口，就自动具有了增删改查、分页查询等方法。</code></p>
<h2 id="1-3-Spring-Data-JPA-与-JPA和hibernate之间的关系"><a href="#1-3-Spring-Data-JPA-与-JPA和hibernate之间的关系" class="headerlink" title="1.3    Spring Data JPA 与 JPA和hibernate之间的关系"></a>1.3    Spring Data JPA 与 JPA和hibernate之间的关系</h2><p>JPA是一套规范，内部是有接口和抽象类组成的。hibernate是一套成熟的ORM框架，而且Hibernate实现了JPA规范，所以也可以称hibernate为JPA的一种实现方式，我们使用JPA的API编程，意味着站在更高的角度上看待问题（面向接口编程）</p>
<p>Spring Data JPA是Spring提供的一套对JPA操作更加高级的封装，是在JPA规范下的专门用来进行数据持久化的解决方案。</p>
<h1 id="第2章-Spring-Data-JPA的快速入门"><a href="#第2章-Spring-Data-JPA的快速入门" class="headerlink" title="第2章    Spring Data JPA的快速入门"></a>第2章    Spring Data JPA的快速入门</h1><h2 id="2-1-需求说明"><a href="#2-1-需求说明" class="headerlink" title="2.1    需求说明"></a>2.1    需求说明</h2><p>Spring Data JPA完成客户的基本CRUD操作</p>
<h2 id="2-2-搭建Spring-Data-JPA的开发环境"><a href="#2-2-搭建Spring-Data-JPA的开发环境" class="headerlink" title="2.2    搭建Spring Data JPA的开发环境"></a>2.2    搭建Spring Data JPA的开发环境</h2><h3 id="2-2-1-引入Spring-Data-JPA的坐标"><a href="#2-2-1-引入Spring-Data-JPA的坐标" class="headerlink" title="2.2.1    引入Spring Data JPA的坐标"></a>2.2.1    引入Spring Data JPA的坐标</h3><p>使用Spring Data JPA，需要整合Spring与Spring Data JPA，并且需要提供JPA的服务提供者hibernate，所以需要导入spring相关坐标，hibernate坐标，数据库驱动坐标等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.4.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hibernate.version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">hibernate.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.6<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">c3p0.version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">c3p0.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- junit单元测试 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- spring beg --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--spring对orm框架支持的包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- spring end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- hibernate beg --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- hibernate end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- c3p0 beg --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;c3p0.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- c3p0 end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- log end --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- log end --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--springdatajpa的坐标--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- el beg 使用spring data jpa 必须引入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- el end --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-整合Spring-Data-JPA与Spring"><a href="#2-2-2-整合Spring-Data-JPA与Spring" class="headerlink" title="2.2.2    整合Spring Data JPA与Spring"></a>2.2.2    整合Spring Data JPA与Spring</h3><p>在resources下创建applicationContext.xml文件:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jpa</span>=<span class="string">"http://www.springframework.org/schema/data/jpa"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/data/jpa</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring 和springDataJpa配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.创建entityManagerFactory对象交给Spring管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"entityManagerFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置的是扫描的包(实体类的所在的包)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span> <span class="attr">value</span>=<span class="string">"com.byliuyu.domain"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa的实现方式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"persistenceProvider"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.hibernate.jpa.HibernatePersistenceProvider"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jpa的供应商适配器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaVendorAdapter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--配置是否自动创建数据库表--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"generateDdl"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--指定数据库类型--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"database"</span> <span class="attr">value</span>=<span class="string">"MYSQL"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--数据库方言，支持的特有语法。比如oracle的rownum，mysql的limit--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"databasePlatform"</span> <span class="attr">value</span>=<span class="string">"org.hibernate.dialect.MySQLDialect"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--是否显示sql语句--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"showSql"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa的方言,高级特性，不是必须写,比如hibernate的一级缓存  二级缓存--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaDialect"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaDialect"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2.创建数据库连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"1234"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///jpa"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--3.整合SpringDataJpa,dao的目录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">"com.byliuyu.dao"</span> <span class="attr">transaction-manager-ref</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">entity-manager-factory-ref</span>=<span class="string">"entityManagerFactory"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--4.配置事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"entityManagerFactory"</span> <span class="attr">ref</span>=<span class="string">"entityManagerFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--5.声明式事务--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--6.配置包扫描,扫描此包下的所有注解--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.byliuyu"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-使用JPA注解配置映射关系"><a href="#2-2-3-使用JPA注解配置映射关系" class="headerlink" title="2.2.3    使用JPA注解配置映射关系"></a>2.2.3    使用JPA注解配置映射关系</h3><p>创建Customer对象,并配置好映射关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 1.实体类和表的映射关系</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Entity</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Table</span></span></span><br><span class="line"><span class="comment"> * 2.类中属性和表字段的映射关系</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Id</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@GeneratedValue</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Column</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"cst_customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long custId; <span class="comment">//客户的主键</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custName;<span class="comment">//客户名称</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_source"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custSource;<span class="comment">//客户来源</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_level"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custLevel;<span class="comment">//客户级别</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_industry"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custIndustry;<span class="comment">//客户所属行业</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_phone"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custPhone;<span class="comment">//客户的联系方式</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"cust_address"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custAddress;<span class="comment">//客户地址</span></span><br><span class="line">    <span class="comment">//此处省略getter和setter方法 .. ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-使用Spring-Data-JPA完成需求"><a href="#2-3-使用Spring-Data-JPA完成需求" class="headerlink" title="2.3    使用Spring Data JPA完成需求"></a>2.3    使用Spring Data JPA完成需求</h2><h3 id="2-3-1-编写符合Spring-Data-JPA规范的Dao层接口"><a href="#2-3-1-编写符合Spring-Data-JPA规范的Dao层接口" class="headerlink" title="2.3.1    编写符合Spring Data JPA规范的Dao层接口"></a>2.3.1    编写符合Spring Data JPA规范的Dao层接口</h3><p>Spring Data JPA是spring提供的一款对于数据访问层（Dao层）的框架，使用Spring Data JPA，只需要按照框架的规范提供dao接口，不需要实现类就可以完成数据库的增删改查、分页查询等方法的定义，极大的简化了我们的开发过程。<br><code>在Spring Data JPA中，对于定义符合规范的Dao层接口，我们只需要遵循以下几点就可以了：</code><br><strong>1.创建一个Dao层接口，并实现JpaRepository和JpaSpecificationExecutor</strong><br><strong>2.提供相应的泛型</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 符合springDataJpa的接口规范,必须继承paRepository和JpaSpecificationExecutor接口</span></span><br><span class="line"><span class="comment"> * JpaRepository&lt;操作的实体类型，实体类主键属性的类型&gt;</span></span><br><span class="line"><span class="comment"> *     *封装了基本的crud操作</span></span><br><span class="line"><span class="comment"> * JpaSpecificationExecutor&lt;操作的实体类型&gt;</span></span><br><span class="line"><span class="comment"> *     *封装了复杂查询，比如分页操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Customer</span>, <span class="title">Long</span>&gt;, <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Customer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//do coder...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就定义好了一个符合Spring Data JPA规范的Dao层接口</p>
<h3 id="2-3-2-完成基本CRUD操作"><a href="#2-3-2-完成基本CRUD操作" class="headerlink" title="2.3.2    完成基本CRUD操作"></a>2.3.2    完成基本CRUD操作</h3><p>完成了Spring Data JPA的环境搭建，并且编写了符合Spring Data JPA 规范的Dao层接口之后，就可以使用定义好的Dao层接口进行客户的基本CRUD操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)  //声明<span class="title">Spring</span>提供的单元测试环境</span></span><br><span class="line"><span class="class">@<span class="title">ContextConfiguration</span>(<span class="title">locations</span> </span>= <span class="string">"classpath:applicationContext.xml"</span>)       <span class="comment">//指定Spring容器的配置信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer = customerDao.findOne(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * save方法：保存或者更新</span></span><br><span class="line"><span class="comment">     *      根据传递的对象是否存在主键id，如果没有主键id属性:保存</span></span><br><span class="line"><span class="comment">     *               存在id属性，根据id查询数据，更新数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer=<span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustName(<span class="string">"LIUYU BLOG"</span>);</span><br><span class="line">        customer.setCustLevel(<span class="string">"VIP"</span>);</span><br><span class="line">        customer.setCustIndustry(<span class="string">"JavaDEVELOP"</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer=<span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustIndustry(<span class="string">"C++"</span>);</span><br><span class="line">        customer.setCustId(<span class="number">4L</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除操作</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line">        customerDao.delete(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 统计查询，查询客户总数量</span></span><br><span class="line"><span class="comment">     *  count:统计总条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">long</span> count = customerDao.count();</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断id为1的客户是否存在</span></span><br><span class="line"><span class="comment">     * 1.可以查询id为1的客户，如果为空，代表不存在，如果不为空，代表存在</span></span><br><span class="line"><span class="comment">     * 2.判断数据库中id为1的客户数量，如果数量为0，代表不存在，如果大于0，代表存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExists</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> exists = customerDao.exists(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(exists);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id从数据库中查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Transactional</span>: 保证getOne能正常运行</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * findone： em.find() 立即加载</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * getOne:  em.getReference  延迟加载</span></span><br><span class="line"><span class="comment">     *          返回的是一个客户动态代理对象，什么时候用，什么时候加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer = customerDao.getOne(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第3章-Spring-Data-JPA的内部原理剖析"><a href="#第3章-Spring-Data-JPA的内部原理剖析" class="headerlink" title="第3章    Spring Data JPA的内部原理剖析"></a>第3章    Spring Data JPA的内部原理剖析</h1><h2 id="3-1-Spring-Data-JPA的常用接口分析"><a href="#3-1-Spring-Data-JPA的常用接口分析" class="headerlink" title="3.1    Spring Data JPA的常用接口分析"></a>3.1    Spring Data JPA的常用接口分析</h2><p>在客户的案例中，我们发现在自定义的CustomerDao中，并没有提供任何方法就可以使用其中的很多方法，那么这些方法究竟是怎么来的呢？答案很简单，对于我们自定义的Dao接口，由于继承了JpaRepository和JpaSpecificationExecutor，所以我们可以使用这两个接口的所有方法。<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/3.jpg" class="lazyload"><br>在使用Spring Data JPA时，一般实现JpaRepository和JpaSpecificationExecutor接口，这样就可以使用这些接口中定义的方法，但是这些方法都只是一些声明，没有具体的实现方式，那么在 Spring Data JPA中它又是怎么实现的呢？</p>
<h2 id="3-2-Spring-Data-JPA的实现过程"><a href="#3-2-Spring-Data-JPA的实现过程" class="headerlink" title="3.2    Spring Data JPA的实现过程"></a>3.2    Spring Data JPA的实现过程</h2><p>通过对客户案例，以debug断点调试的方式，通过分析Spring Data JPA的原来来分析程序的执行过程<br>我们以findOne方法为例进行分析</p>
<ul>
<li><p>代理子类的实现过程<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/4.jpg" class="lazyload"><br>断点执行到方法上时，我们可以发现注入的customerDao对象，本质上是通过JdkDynamicAopProxy生成的一个代理对象</p>
</li>
<li><p>代理对象中方法调用的分析<br>当程序执行的时候，会通过JdkDynamicAopProxy的invoke方法，对customerDao对象生成动态代理对象。根据对Spring Data JPA介绍而知，要想进行findOne查询方法，最终还是会出现JPA规范的API完成操作，那么这些底层代码存在于何处呢？答案很简单，都隐藏在通过JdkDynamicAopProxy生成的动态代理对象当中，而这个动态代理对象就是SimpleJpaRepository<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/5.jpg" class="lazyload"><br>通过SimpleJpaRepository的源码分析，定位到了findOne方法，在此方法中，返回em.find()的返回结果，那么em又是什么呢？<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/6.jpg" class="lazyload"></p>
</li>
</ul>
<p>带着问题继续查找em对象，我们发现em就是EntityManager对象，而他是JPA原生的实现方式，所以我们得到结论Spring Data JPA只是对标准JPA操作进行了进一步封装，简化了Dao层代码的开发</p>
<h2 id="3-3-Spring-Data-JPA完整的调用过程分析"><a href="#3-3-Spring-Data-JPA完整的调用过程分析" class="headerlink" title="3.3    Spring Data JPA完整的调用过程分析"></a>3.3    Spring Data JPA完整的调用过程分析</h2><p><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/7.jpg" class="lazyload"></p>
<h1 id="第4章-Spring-Data-JPA的查询方式"><a href="#第4章-Spring-Data-JPA的查询方式" class="headerlink" title="第4章    Spring Data JPA的查询方式"></a>第4章    Spring Data JPA的查询方式</h1><h2 id="4-1-使用Spring-Data-JPA中接口定义的方法进行查询"><a href="#4-1-使用Spring-Data-JPA中接口定义的方法进行查询" class="headerlink" title="4.1    使用Spring Data JPA中接口定义的方法进行查询"></a>4.1    使用Spring Data JPA中接口定义的方法进行查询</h2><p>在继承JpaRepository，和JpaRepository接口后,我们就可以使用接口中定义的方法进行查询</p>
<ul>
<li><p>继承JpaRepository后的方法列表<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/8.jpg" class="lazyload"></p>
</li>
<li><p>继承JpaSpecificationExecutor的方法列表<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/9.jpg" class="lazyload"></p>
</li>
</ul>
<h2 id="4-2-使用JPQL的方式查询"><a href="#4-2-使用JPQL的方式查询" class="headerlink" title="4.2    使用JPQL的方式查询"></a>4.2    使用JPQL的方式查询</h2><p>使用Spring Data JPA提供的查询方法已经可以解决大部分的应用场景，但是对于某些业务来说，我们还需要灵活的构造查询条件，这时就可以使用@Query注解，结合JPQL的语句方式完成查询<br><code>@Query 注解的使用非常简单，只需在方法上面标注该注解，同时提供一个JPQL查询语句即可</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 案例：根据客户名称查询客户</span></span><br><span class="line"><span class="comment">     *  jpql:from customer where custName = ?</span></span><br><span class="line"><span class="comment">     *  配置jpql语句:使用<span class="doctag">@Query</span>注解</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Query</span>(value = <span class="string">"from Customer where custName = ?"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findJpql</span><span class="params">(String custName)</span></span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 案例：根据客户名称和客户id查询客户</span></span><br><span class="line"><span class="comment">     * jpql:from customer where custName = ? and custId =?</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  对于多个占位符参数，赋值的时候，默认情况下，占位符的位置需要和方法参数中的位置保持一致</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  可以指定占位符的参数位置</span></span><br><span class="line"><span class="comment">     *  ？索引的方式，指定占位符的取值来源</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Query</span>(value = <span class="string">"from Customer where custName = ?2 and custId =?1"</span>)</span><br><span class="line">   <span class="comment">/* public Customer findCustNameAndId(String name,Long id);*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findCustNameAndId</span><span class="params">(Long id,String name)</span></span>;</span><br></pre></td></tr></table></figure>
<p>此外，也可以通过使用 @Query 来执行一个更新操作，为此，我们需要在使用 @Query 的同时，用 @Modifying 来将该操作标识为修改查询，这样框架最终会生成一个更新的操作，而非查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使jpql完成更新操作</span></span><br><span class="line"><span class="comment">    *  案例：根据id更新客户名称</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *   sql:update cst_customer  set cust_name =? where cust_id= ?</span></span><br><span class="line"><span class="comment">    *   jpql: update Customer set custName= ？ and custId = ?</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *   <span class="doctag">@Query</span>: 代表查询操作</span></span><br><span class="line"><span class="comment">    *   <span class="doctag">@Modifying</span>： 代表更新操作</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Query</span>(value = <span class="string">"update Customer set custName= ?2 where custId = ?1"</span>)</span><br><span class="line">   <span class="meta">@Modifying</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCustomer</span><span class="params">(Long id,String name)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="4-3-使用SQL语句查询"><a href="#4-3-使用SQL语句查询" class="headerlink" title="4.3    使用SQL语句查询"></a>4.3    使用SQL语句查询</h2><p>Spring Data JPA同样也支持sql语句的查询，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用sql的形式查询：</span></span><br><span class="line"><span class="comment">     *     查询全部的客户</span></span><br><span class="line"><span class="comment">     *  sql ： select * from cst_customer;</span></span><br><span class="line"><span class="comment">     *  Query : 配置sql查询</span></span><br><span class="line"><span class="comment">     *      value ： sql语句</span></span><br><span class="line"><span class="comment">     *      nativeQuery ： 查询方式</span></span><br><span class="line"><span class="comment">     *          true ： sql查询</span></span><br><span class="line"><span class="comment">     *          false：jpql查询</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@Query(value = " select * from cst_customer" ,nativeQuery = true)</span></span><br><span class="line">    <span class="meta">@Query</span>(value=<span class="string">"select * from cst_customer where cust_name like ?1"</span>,nativeQuery = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">public</span> List&lt;Object [] &gt; findSql(String name);</span><br></pre></td></tr></table></figure>

<h2 id="4-4-方法命名规则查询"><a href="#4-4-方法命名规则查询" class="headerlink" title="4.4    方法命名规则查询"></a>4.4    方法命名规则查询</h2><p>顾名思义，方法命名规则查询就是根据方法的名字，就能创建查询。只需要按照Spring Data JPA提供的方法命名规则定义方法的名称，就可以完成查询工作。Spring Data JPA在程序执行的时候会根据方法名称进行解析，并自动生成查询语句进行查询<br><code>按照Spring Data JPA 定义的规则，查询方法以findBy开头，涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性首字母需大写。</code><br><code>框架在进行方法名解析时，会先把方法名多余的前缀截取掉，然后对剩下部分进行解析。</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法名的约定：</span></span><br><span class="line"><span class="comment"> *      findBy : 查询</span></span><br><span class="line"><span class="comment"> *            对象中的属性名（首字母大写） ： 查询的条件</span></span><br><span class="line"><span class="comment"> *            CustName</span></span><br><span class="line"><span class="comment"> *            * 默认情况 ： 使用 等于的方式查询</span></span><br><span class="line"><span class="comment"> *                  特殊的查询方式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  findByCustName   --   根据客户名称查询</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  再springdataJpa的运行阶段</span></span><br><span class="line"><span class="comment"> *          会根据方法名称进行解析  findBy    from  xxx(实体类)</span></span><br><span class="line"><span class="comment"> *                                      属性名称      where  custName =</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      1.findBy  + 属性名称 （根据属性名称进行完成匹配的查询=）</span></span><br><span class="line"><span class="comment"> *      2.findBy  + 属性名称 + “查询方式（Like | isnull）”</span></span><br><span class="line"><span class="comment"> *          findByCustNameLike</span></span><br><span class="line"><span class="comment"> *      3.多条件查询</span></span><br><span class="line"><span class="comment"> *          findBy + 属性名 + “查询方式”   + “多条件的连接符（and|or）”  + 属性名 + “查询方式”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">findByCustName</span><span class="params">(String custName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据姓名模糊查询</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">findByCustNameLike</span><span class="params">(String custName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用客户名称模糊匹配和客户所属行业精准匹配的查询</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">findByCustNameLikeAndCustIndustry</span><span class="params">(String custName,String custIndustry)</span></span>;</span><br></pre></td></tr></table></figure>
<p>具体的关键字，使用方法和生产成SQL如下表所示:</p>
<table>
<thead>
<tr>
<th align="center">Keyword</th>
<th align="center">Sample</th>
<th align="center">JPQL</th>
</tr>
</thead>
<tbody><tr>
<td align="center">And</td>
<td align="center">findByLastnameAndFirstname</td>
<td align="center">… where x.lastname = ?1 and x.firstname = ?2</td>
</tr>
<tr>
<td align="center">Or</td>
<td align="center">findByLastnameOrFirstname</td>
<td align="center">… where x.lastname = ?1 or x.firstname = ?2</td>
</tr>
<tr>
<td align="center">Equals</td>
<td align="center">findByFirstnameIs/findByFirstnameEquals</td>
<td align="center">… where x.firstname = ?1</td>
</tr>
<tr>
<td align="center">Between</td>
<td align="center">findByStartDateBetween</td>
<td align="center">… where x.startDate between ?1 and ?2</td>
</tr>
<tr>
<td align="center">LessThan</td>
<td align="center">findByAgeLessThan</td>
<td align="center">… where x.age &lt; ?1</td>
</tr>
<tr>
<td align="center">LessThanEqual</td>
<td align="center">findByAgeLessThanEqual</td>
<td align="center">… where x.age ⇐ ?1</td>
</tr>
<tr>
<td align="center">GreaterThan</td>
<td align="center">findByAgeGreaterThan</td>
<td align="center">… where x.age &gt; ?1</td>
</tr>
<tr>
<td align="center">GreaterThanEqual</td>
<td align="center">findByAgeGreaterThanEqual</td>
<td align="center">… where x.age &gt;= ?1</td>
</tr>
<tr>
<td align="center">After</td>
<td align="center">findByStartDateAfter</td>
<td align="center">… where x.startDate &gt; ?1</td>
</tr>
<tr>
<td align="center">Before</td>
<td align="center">findByStartDateBefore</td>
<td align="center">… where x.startDate &lt; ?1</td>
</tr>
<tr>
<td align="center">IsNull</td>
<td align="center">findByAgeIsNull</td>
<td align="center">… where x.age is null</td>
</tr>
<tr>
<td align="center">IsNotNull,NotNull</td>
<td align="center">findByAge(Is)NotNull</td>
<td align="center">… where x.age not null</td>
</tr>
<tr>
<td align="center">Like</td>
<td align="center">findByFirstnameLike</td>
<td align="center">… where x.firstname like ?1</td>
</tr>
<tr>
<td align="center">NotLike</td>
<td align="center">findByFirstnameNotLike</td>
<td align="center">… where x.firstname not like ?1</td>
</tr>
<tr>
<td align="center">StartingWith</td>
<td align="center">findByFirstnameStartingWith</td>
<td align="center">… where x.firstname like ?1 (parameter bound with appended %)</td>
</tr>
<tr>
<td align="center">EndingWith</td>
<td align="center">findByFirstnameEndingWith</td>
<td align="center">… where x.firstname like ?1 (parameter bound with prepended %)</td>
</tr>
<tr>
<td align="center">Containing</td>
<td align="center">findByFirstnameContaining</td>
<td align="center">… where x.firstname like ?1 (parameter bound wrapped in %)</td>
</tr>
<tr>
<td align="center">OrderBy</td>
<td align="center">findByAgeOrderByLastnameDesc</td>
<td align="center">… where x.age = ?1 order by x.lastname desc</td>
</tr>
<tr>
<td align="center">Not</td>
<td align="center">findByLastnameNot</td>
<td align="center">… where x.lastname &lt;&gt; ?1</td>
</tr>
<tr>
<td align="center">In</td>
<td align="center">findByAgeIn(Collection ages)</td>
<td align="center">… where x.age in ?1</td>
</tr>
<tr>
<td align="center">NotIn</td>
<td align="center">findByAgeNotIn(Collection age)</td>
<td align="center">… where x.age not in ?1</td>
</tr>
<tr>
<td align="center">TRUE</td>
<td align="center">findByActiveTrue()</td>
<td align="center">… where x.active = true</td>
</tr>
<tr>
<td align="center">FALSE</td>
<td align="center">findByActiveFalse()</td>
<td align="center">… where x.active = false</td>
</tr>
<tr>
<td align="center">IgnoreCase</td>
<td align="center">findByFirstnameIgnoreCase</td>
<td align="center">… where UPPER(x.firstame) = UPPER(?1)</td>
</tr>
</tbody></table>
<h1 id="第5章-Specifications动态查询"><a href="#第5章-Specifications动态查询" class="headerlink" title="第5章    Specifications动态查询"></a>第5章    Specifications动态查询</h1><p>有时我们在查询某个实体的时候，给定的条件是不固定的，这时就需要动态构建相应的查询语句，在Spring Data JPA中可以通过JpaSpecificationExecutor接口查询。相比JPQL,其优势是类型安全,更加的面向对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Sort;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.domain.Specification;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	JpaSpecificationExecutor中定义的方法</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">   	<span class="comment">//根据条件查询一个对象</span></span><br><span class="line"> 	<span class="function">T <span class="title">findOne</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;	</span><br><span class="line">   	<span class="comment">//根据条件查询集合</span></span><br><span class="line"> 	<span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line">   	<span class="comment">//根据条件分页查询</span></span><br><span class="line"> 	<span class="function">Page&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Pageable pageable)</span></span>;</span><br><span class="line">   	<span class="comment">//排序查询查询</span></span><br><span class="line"> 	<span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Sort sort)</span></span>;</span><br><span class="line">   	<span class="comment">//统计查询</span></span><br><span class="line"> 	<span class="function"><span class="keyword">long</span> <span class="title">count</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>对于JpaSpecificationExecutor，这个接口基本是围绕着Specification接口来定义的。我们可以简单的理解为，Specification构造的就是查询条件。</code></p>
<p>Specification接口中只定义了如下一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造查询条件</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *	root	：Root接口，代表查询的根对象，可以通过root获取实体中的属性</span></span><br><span class="line"><span class="comment">   *	query	：代表一个顶层查询对象，用来自定义查询</span></span><br><span class="line"><span class="comment">   *	cb		：用来构建查询，此对象里有很多条件方法</span></span><br><span class="line"><span class="comment">   **/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="5-1-使用Specifications完成条件查询"><a href="#5-1-使用Specifications完成条件查询" class="headerlink" title="5.1    使用Specifications完成条件查询"></a>5.1    使用Specifications完成条件查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据条件，查询单个对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpec</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//匿名内部类</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义查询条件</span></span><br><span class="line"><span class="comment">     *      1.实现Specification接口（提供泛型：查询的对象类型）</span></span><br><span class="line"><span class="comment">     *      2.实现toPredicate方法（构造查询条件）</span></span><br><span class="line"><span class="comment">     *      3.需要借助方法参数中的两个参数（</span></span><br><span class="line"><span class="comment">     *          root：获取需要查询的对象属性</span></span><br><span class="line"><span class="comment">     *          CriteriaBuilder：构造查询条件的，内部封装了很多的查询条件（模糊匹配，精准匹配）</span></span><br><span class="line"><span class="comment">     *       ）</span></span><br><span class="line"><span class="comment">     *  案例：根据客户名称查询，查询客户名为传智播客的客户</span></span><br><span class="line"><span class="comment">     *          查询条件</span></span><br><span class="line"><span class="comment">     *              1.查询方式</span></span><br><span class="line"><span class="comment">     *                  cb对象</span></span><br><span class="line"><span class="comment">     *              2.比较的属性名称</span></span><br><span class="line"><span class="comment">     *                  root对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Specification&lt;Customer&gt; spec=<span class="keyword">new</span> Specification&lt;Customer&gt;() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//1.获取比较的属性</span></span><br><span class="line">            Path&lt;Object&gt; custName = root.get(<span class="string">"custName"</span>);</span><br><span class="line">            <span class="comment">//2.构造查询条件  ：    select * from cst_customer where cust_name = '传智播客'</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 第一个参数：需要比较的属性（path对象）</span></span><br><span class="line"><span class="comment">             * 第二个参数：当前需要比较的取值</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            Predicate predicate = cb.equal(custName, <span class="string">"Spring"</span>);<span class="comment">//进行精准的匹配  （比较的属性，比较的属性的取值）</span></span><br><span class="line">            <span class="keyword">return</span> predicate;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Customer customer=customerDao.findOne(spec);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多条件查询</span></span><br><span class="line"><span class="comment"> *  案例：根据客户名（Spring）和客户所属行业查询（java）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryBynameAndcustIndustry</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  root:获取属性</span></span><br><span class="line"><span class="comment">     *      客户名</span></span><br><span class="line"><span class="comment">     *      所属行业</span></span><br><span class="line"><span class="comment">     *  cb：构造查询</span></span><br><span class="line"><span class="comment">     *      1.构造客户名的精准匹配查询</span></span><br><span class="line"><span class="comment">     *      2.构造所属行业的精准匹配查询</span></span><br><span class="line"><span class="comment">     *      3.将以上两个查询联系起来</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Specification&lt;Customer&gt; spec=<span class="keyword">new</span> Specification&lt;Customer&gt;() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//获取客户名属性</span></span><br><span class="line">            Path&lt;Object&gt;custName=root.get(<span class="string">"custName"</span>);</span><br><span class="line">            <span class="comment">//获取所属行业属性</span></span><br><span class="line">            Path&lt;Object&gt;custIndustry=root.get(<span class="string">"custIndustry"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//构造查询</span></span><br><span class="line">            <span class="comment">//1.构造客户名的精准匹配查询</span></span><br><span class="line">            Predicate p1=cb.equal(custName,<span class="string">"spring"</span>);</span><br><span class="line">            <span class="comment">//2..构造所属行业的精准匹配查询</span></span><br><span class="line">            Predicate p2=cb.equal(custIndustry,<span class="string">"java"</span>);</span><br><span class="line">            <span class="comment">//3.将多个查询条件组合到一起：组合（满足条件一并且满足条件二：与关系，满足条件一或满足条件二即可：或关系）</span></span><br><span class="line">            Predicate and=cb.and(p1,p2);</span><br><span class="line">            <span class="comment">// cb.or();//以或的形式拼接多个查询条件</span></span><br><span class="line">            <span class="keyword">return</span> and;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Customer customer = customerDao.findOne(spec);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 案例：完成根据客户名称的模糊匹配，返回客户列表</span></span><br><span class="line"><span class="comment"> *      客户名称以 ’传智播客‘ 开头</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * equal ：直接的到path对象（属性），然后进行比较即可</span></span><br><span class="line"><span class="comment"> * gt，lt,ge,le,like : 得到path对象，根据path指定比较的参数类型，再去进行比较</span></span><br><span class="line"><span class="comment"> *      指定参数类型：path.as(类型的字节码对象)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLikeCustName</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//构造查询条件</span></span><br><span class="line">    Specification spec=<span class="keyword">new</span> Specification() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root root, CriteriaQuery query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//查询属性：客户名</span></span><br><span class="line">            Path&lt;Object&gt; custName = root.get(<span class="string">"custName"</span>);</span><br><span class="line">            <span class="comment">//查询方式：模糊匹配</span></span><br><span class="line">            Predicate predicate = cb.like(custName.as(String.class), "Spring%");</span><br><span class="line">            <span class="keyword">return</span> predicate;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//模糊查询，可能有多条数据，不能使用findOne，必须使用findAll</span></span><br><span class="line">    <span class="comment">/*List&lt;Customer&gt; customer=customerDao.findAll(spec);</span></span><br><span class="line"><span class="comment">    for (Customer cust:customer) &#123;</span></span><br><span class="line"><span class="comment">        System.out.println(cust);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="comment">//添加排序</span></span><br><span class="line">    <span class="comment">//创建排序对象,需要调用构造方法实例化sort对象</span></span><br><span class="line">    <span class="comment">//第一个参数：排序的顺序（倒序，正序）</span></span><br><span class="line">    <span class="comment">//   Sort.Direction.DESC:倒序</span></span><br><span class="line">    <span class="comment">//   Sort.Direction.ASC ： 升序</span></span><br><span class="line">    <span class="comment">//第二个参数：排序的属性名称</span></span><br><span class="line">    Sort sort = <span class="keyword">new</span> Sort(Sort.Direction.DESC,<span class="string">"custId"</span>);</span><br><span class="line">    List&lt;Customer&gt; list = customerDao.findAll(spec, sort);</span><br><span class="line">    <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="5-2-基于Specifications的分页查询"><a href="#5-2-基于Specifications的分页查询" class="headerlink" title="5.2    基于Specifications的分页查询"></a>5.2    基于Specifications的分页查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> *      Specification: 查询条件</span></span><br><span class="line"><span class="comment"> *      Pageable：分页参数</span></span><br><span class="line"><span class="comment"> *          分页参数：查询的页码，每页查询的条数</span></span><br><span class="line"><span class="comment"> *          findAll(Specification,Pageable)：带有条件的分页</span></span><br><span class="line"><span class="comment"> *          findAll(Pageable)：没有条件的分页</span></span><br><span class="line"><span class="comment"> *  返回：Page（springDataJpa为我们封装好的pageBean对象，数据列表，共条数）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPage</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Specification spec = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//PageRequest对象是Pageable接口的实现类</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建PageRequest的过程中，需要调用他的构造方法传入两个参数</span></span><br><span class="line"><span class="comment">     *      第一个参数：当前查询的页数（从0开始）</span></span><br><span class="line"><span class="comment">     *      第二个参数：每页查询的数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Pageable pageable=<span class="keyword">new</span> PageRequest(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页查询,查询条件为null，把所有数据分页查询</span></span><br><span class="line">    Page&lt;Customer&gt; page=customerDao.findAll(<span class="keyword">null</span>,pageable);</span><br><span class="line">    System.out.println(<span class="string">"得到数据集合列表"</span>+page.getContent()); <span class="comment">//得到数据集合列表</span></span><br><span class="line">    System.out.println(<span class="string">"得到总条数"</span>+page.getTotalElements());<span class="comment">//得到总条数</span></span><br><span class="line">    System.out.println(<span class="string">"得到总页数"</span>+page.getTotalPages());<span class="comment">//得到总页数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于Spring Data JPA中的分页查询，是其内部自动实现的封装过程，返回的是一个Spring Data JPA提供的pageBean对象。其中的方法说明如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取总页数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getTotalPages</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//获取总记录数	</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">getTotalElements</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//获取列表数据</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">getContent</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-方法对应关系"><a href="#5-3-方法对应关系" class="headerlink" title="5.3    方法对应关系"></a>5.3    方法对应关系</h2><table>
<thead>
<tr>
<th align="center">方法名称</th>
<th align="center">Sql对应关系</th>
</tr>
</thead>
<tbody><tr>
<td align="center">equle</td>
<td align="center">filed = value</td>
</tr>
<tr>
<td align="center">gt（greaterThan ）</td>
<td align="center">filed &gt; value</td>
</tr>
<tr>
<td align="center">lt（lessThan ）</td>
<td align="center">filed &lt; value</td>
</tr>
<tr>
<td align="center">ge（greaterThanOrEqualTo ）</td>
<td align="center">filed &gt;= value</td>
</tr>
<tr>
<td align="center">le（ lessThanOrEqualTo）</td>
<td align="center">filed &lt;= value</td>
</tr>
<tr>
<td align="center">notEqule</td>
<td align="center">filed != value</td>
</tr>
<tr>
<td align="center">like</td>
<td align="center">filed like value</td>
</tr>
<tr>
<td align="center">notLike</td>
<td align="center">filed not like value</td>
</tr>
</tbody></table>
<h1 id="第6章-多表设计"><a href="#第6章-多表设计" class="headerlink" title="第6章    多表设计"></a>第6章    多表设计</h1><h2 id="6-1-表之间关系的划分"><a href="#6-1-表之间关系的划分" class="headerlink" title="6.1    表之间关系的划分"></a>6.1    表之间关系的划分</h2><p>数据库中多表之间存在着三种关系，如图所示。<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/6.1.jpg" class="lazyload"><br>从图可以看出，系统设计的三种实体关系分别为：<code>多对多、一对多和一对一关系</code>。<br>注意：一对多关系可以看为两种：  即一对多，多对一。所以说四种更精确。<br>明确：教程只涉及实际开发中常用的关联关系，一对多和多对多。而一对一的情况，在实际开发中几乎不用。</p>
<h2 id="6-2-在JPA框架中表关系的分析步骤"><a href="#6-2-在JPA框架中表关系的分析步骤" class="headerlink" title="6.2    在JPA框架中表关系的分析步骤"></a>6.2    在JPA框架中表关系的分析步骤</h2><p>在实际开发中，我们数据库的表难免会有相互的关联关系，在操作表的时候就有可能会涉及到多张表的操作。而在这种实现了ORM思想的框架中（如JPA），可以让我们通过操作实体类就实现对数据库表的操作。所以今天我们的学习重点是：掌握配置实体之间的关联关系。</p>
<h3 id="第一步：首先确定两张表之间的关系。"><a href="#第一步：首先确定两张表之间的关系。" class="headerlink" title="第一步：首先确定两张表之间的关系。"></a>第一步：首先确定两张表之间的关系。</h3><pre><code>如果关系确定错了，后面做的所有操作就都不可能正确。</code></pre><h3 id="第二步：在数据库中实现两张表的关系"><a href="#第二步：在数据库中实现两张表的关系" class="headerlink" title="第二步：在数据库中实现两张表的关系"></a>第二步：在数据库中实现两张表的关系</h3><h3 id="第三步：在实体类中描述出两个实体的关系"><a href="#第三步：在实体类中描述出两个实体的关系" class="headerlink" title="第三步：在实体类中描述出两个实体的关系"></a>第三步：在实体类中描述出两个实体的关系</h3><h3 id="第四步：配置出实体类和数据库表的关系映射（重点）"><a href="#第四步：配置出实体类和数据库表的关系映射（重点）" class="headerlink" title="第四步：配置出实体类和数据库表的关系映射（重点）"></a>第四步：配置出实体类和数据库表的关系映射（重点）</h3><h1 id="第7章-JPA中的一对多"><a href="#第7章-JPA中的一对多" class="headerlink" title="第7章    JPA中的一对多"></a>第7章    JPA中的一对多</h1><h2 id="7-1-示例分析"><a href="#7-1-示例分析" class="headerlink" title="7.1    示例分析"></a>7.1    示例分析</h2><p> 我们采用的示例为客户和联系人。</p>
<p> 客户：指的是一家公司，我们记为A。</p>
<p> 联系人：指的是A公司中的员工。</p>
<p> 在不考虑兼职的情况下，公司和员工的关系即为一对多。</p>
<h2 id="7-2-表关系建立"><a href="#7-2-表关系建立" class="headerlink" title="7.2    表关系建立"></a>7.2    表关系建立</h2><p>在一对多关系中，我们习惯把一的一方称之为主表，把多的一方称之为从表。在数据库中建立一对多的关系，需要使用数据库的外键约束。<br>什么是外键？<br>指的是从表中有一列，取值参照主表的主键，这一列就是外键。<br>一对多数据库关系的建立，如下图所示：<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/7.2.jpg" class="lazyload"></p>
<h2 id="7-3-实体类关系建立以及映射配置"><a href="#7-3-实体类关系建立以及映射配置" class="headerlink" title="7.3    实体类关系建立以及映射配置"></a>7.3    实体类关系建立以及映射配置</h2><p>之前Customer客户表已经创建，现在创建linkMan联系人表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建联系人表*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> cst_linkman (</span><br><span class="line">  lkm_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'联系人编号(主键)'</span>,</span><br><span class="line">  lkm_name <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人姓名'</span>,</span><br><span class="line">  lkm_gender <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人性别'</span>,</span><br><span class="line">  lkm_phone <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人办公电话'</span>,</span><br><span class="line">  lkm_mobile <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人手机'</span>,</span><br><span class="line">  lkm_email <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人邮箱'</span>,</span><br><span class="line">  lkm_position <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人职位'</span>,</span><br><span class="line">  lkm_memo <span class="built_in">varchar</span>(<span class="number">512</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'联系人备注'</span>,</span><br><span class="line">  lkm_cust_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户id(外键)'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`lkm_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`FK_cst_linkman_lkm_cust_id`</span> (<span class="string">`lkm_cust_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`FK_cst_linkman_lkm_cust_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`lkm_cust_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`cst_customer`</span> (<span class="string">`cust_id`</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">3</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<p>在实体类中，由于客户是少的一方，它应该包含多个联系人，所以实体类要体现出客户中有多个联系人的信息，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * /**</span></span><br><span class="line"><span class="comment"> * 1.实体类和表的映射关系</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Eitity</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Table</span> 2.类中属性和表中字段的映射关系</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Id</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@GeneratedValue</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Column</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"cst_customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long custId;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_address"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custAddress;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_industry"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custIndustry;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_level"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custLevel;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custName;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_phone"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custPhone;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"cust_source"</span>)</span><br><span class="line">    <span class="keyword">private</span> String custSource;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置客户和联系人之间的关系（一对多关系）</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用注解的形式配置多表关系</span></span><br><span class="line"><span class="comment">     * 1.声明关系</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@OneToMany</span> : 配置一对多关系</span></span><br><span class="line"><span class="comment">     * targetEntity ：对方对象的字节码对象</span></span><br><span class="line"><span class="comment">     * 2.配置外键（中间表）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@JoinColumn</span> : 配置外键</span></span><br><span class="line"><span class="comment">     * name：外键字段名称</span></span><br><span class="line"><span class="comment">     * referencedColumnName：参照的主表的主键字段名称</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * * 在客户实体类上（一的一方）添加了外键了配置，所以对于客户而言，也具备了维护外键的作用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OneToMany</span>(targetEntity = LinkMan<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">JoinColumn</span>(<span class="title">name</span> </span>= <span class="string">"lkm_cust_id"</span>,referencedColumnName = <span class="string">"cust_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="comment">//此处省略getter和setter方法 .. ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于联系人是多的一方，在实体类中要体现出，每个联系人只能对应一个客户，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"cst_linkman"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkMan</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long lkmId; <span class="comment">//联系人编号(主键)</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lkmName;<span class="comment">//联系人姓名</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_gender"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lkmGender;<span class="comment">//联系人性别</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_phone"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lkmPhone;<span class="comment">//联系人办公电话</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_mobile"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lkmMobile;<span class="comment">//联系人手机</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_email"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lkmEmail;<span class="comment">//联系人邮箱</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_position"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lkmPosition;<span class="comment">//联系人职位</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"lkm_memo"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lkmMemo;<span class="comment">//联系人备注</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置联系人到客户的多对一关系</span></span><br><span class="line"><span class="comment">     *     使用注解的形式配置多对一关系</span></span><br><span class="line"><span class="comment">     *      1.配置表关系</span></span><br><span class="line"><span class="comment">     *          <span class="doctag">@ManyToOne</span> : 配置多对一关系</span></span><br><span class="line"><span class="comment">     *              targetEntity：对方的实体类字节码</span></span><br><span class="line"><span class="comment">     *      2.配置外键（中间表）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * * 配置外键的过程，配置到了多的一方，就会在多的一方维护外键</span></span><br><span class="line"><span class="comment">     *      fetch : 配置关联对象的加载方式</span></span><br><span class="line"><span class="comment">     *               EAGER   ：立即加载</span></span><br><span class="line"><span class="comment">     *               LAZY    ：延迟加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ManyToOne</span>(targetEntity = Customer<span class="class">.<span class="keyword">class</span>,<span class="title">fetch</span> </span>= FetchType.LAZY)</span><br><span class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"lkm_cust_id"</span>,referencedColumnName = <span class="string">"cust_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Customer customer;</span><br><span class="line">    <span class="comment">//此处省略getter和setter方法 .. ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-4-映射的注解说明"><a href="#7-4-映射的注解说明" class="headerlink" title="7.4    映射的注解说明"></a>7.4    映射的注解说明</h2><p><strong>@OneToMany</strong>:<br>作用：建立一对多的关系映射<br>    属性：<br>        targetEntityClass：指定多的多方的类的字节码<br>        mappedBy：指定从表实体类中引用主表对象的名称。<br>        cascade：指定要使用的级联操作<br>        fetch：指定是否采用延迟加载<br>        orphanRemoval：是否使用孤儿删除<br><strong>@ManyToOne</strong>:<br>作用：建立多对一的关系<br>    属性：<br>        targetEntityClass：指定一的一方实体类字节码<br>        cascade：指定要使用的级联操作<br>        fetch：指定是否采用延迟加载<br>        optional：关联是否可选。如果设置为false，则必须始终存在非空关系。<br><strong>@JoinColumn</strong>:<br>作用：用于定义主键字段和外键字段的对应关系。<br>     属性：<br>        name：指定外键字段的名称<br>        referencedColumnName：指定引用主表的主键字段名称<br>        unique：是否唯一。默认值不唯一<br>        nullable：是否允许为空。默认值允许。<br>        insertable：是否允许插入。默认值允许。<br>        updatable：是否允许更新。默认值允许。<br>        columnDefinition：列的定义信息。</p>
<h2 id="7-5-一对多的操作"><a href="#7-5-一对多的操作" class="headerlink" title="7.5    一对多的操作"></a>7.5    一对多的操作</h2><h3 id="7-5-1-添加"><a href="#7-5-1-添加" class="headerlink" title="7.5.1    添加"></a>7.5.1    添加</h3><p>ApplicationContext.xml配置如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jpa</span>=<span class="string">"http://www.springframework.org/schema/data/jpa"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/data/jpa</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring 和springDataJpa配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.创建entityManagerFactory对象交给Spring管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"entityManagerFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置的是扫描的包(实体类的所在的包)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span> <span class="attr">value</span>=<span class="string">"com.byliuyu.domain"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa的实现方式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"persistenceProvider"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.hibernate.jpa.HibernatePersistenceProvider"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jpa的供应商适配器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaVendorAdapter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--配置是否自动创建数据库表--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"generateDdl"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--指定数据库类型--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"database"</span> <span class="attr">value</span>=<span class="string">"MYSQL"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--数据库方言，支持的特有语法。比如oracle的rownum，mysql的limit--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"databasePlatform"</span> <span class="attr">value</span>=<span class="string">"org.hibernate.dialect.MySQLDialect"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--是否显示sql语句--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"showSql"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa的方言,高级特性，不是必须写,比如hibernate的一级缓存  二级缓存--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaDialect"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaDialect"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--注入jpa的配置信息</span></span><br><span class="line"><span class="comment">            加载jpa的基本配置信息和jpa实现方式（hibernate）的配置信息</span></span><br><span class="line"><span class="comment">            hibernate.hbm2ddl.auto : 自动创建数据库表</span></span><br><span class="line"><span class="comment">                create ： 每次都会重新创建数据库表</span></span><br><span class="line"><span class="comment">                update：有表不会重新创建，没有表会重新创建表</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaProperties"</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>create<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2.创建数据库连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"1234"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///jpa"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--3.整合SpringDataJpa,dao的目录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">"com.byliuyu.dao"</span> <span class="attr">transaction-manager-ref</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">entity-manager-factory-ref</span>=<span class="string">"entityManagerFactory"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--4.配置事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"entityManagerFactory"</span> <span class="attr">ref</span>=<span class="string">"entityManagerFactory"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--5.声明式事务--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--6.配置包扫描,扫描此包下的所有注解--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.byliuyu"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写测试类:<br><strong>配置了客户到联系人的关系</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LinkManDao linkManDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存一个客户，保存一个联系人</span></span><br><span class="line"><span class="comment">     *  效果：客户和联系人作为独立的数据保存到数据库中</span></span><br><span class="line"><span class="comment">     *      联系人的外键为空</span></span><br><span class="line"><span class="comment">     *  原因？</span></span><br><span class="line"><span class="comment">     *      实体类中没有配置关系</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line">    <span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个客户，创建一个联系人</span></span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCustName(<span class="string">"百度"</span>);</span><br><span class="line"></span><br><span class="line">        LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">        linkMan.setLkmName(<span class="string">"小李"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 配置了客户到联系人的关系</span></span><br><span class="line"><span class="comment">         *      从客户的角度上：发送两条insert语句，发送一条更新语句更新数据库（更新外键）</span></span><br><span class="line"><span class="comment">         * 由于我们配置了客户到联系人的关系：客户可以对外键进行维护</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        customer.getLinkMans().add(linkMan);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">        linkManDao.save(linkMan);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>配置联系人到客户的关系（多对一）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个客户，创建一个联系人</span></span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setCustName(<span class="string">"百度"</span>);</span><br><span class="line"></span><br><span class="line">    LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">    linkMan.setLkmName(<span class="string">"小李"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置联系人到客户的关系（多对一）</span></span><br><span class="line"><span class="comment">     *    只发送了两条insert语句</span></span><br><span class="line"><span class="comment">     * 由于配置了联系人到客户的映射关系（多对一）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    linkMan.setCustomer(customer);</span><br><span class="line">    customerDao.save(customer);</span><br><span class="line">    linkManDao.save(linkMan);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置客户到联系人和联系人到客户关系</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *      此案例会有一条多余的update语句</span></span><br><span class="line"><span class="comment"> *      * 由于一的一方可以维护外键：会发送update语句</span></span><br><span class="line"><span class="comment"> *      * 解决此问题：只需要在一的一方放弃维护权即可</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个客户，创建一个联系人</span></span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setCustName(<span class="string">"百度"</span>);</span><br><span class="line"></span><br><span class="line">    LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">    linkMan.setLkmName(<span class="string">"小李"</span>);</span><br><span class="line">    </span><br><span class="line">    linkMan.setCustomer(customer);<span class="comment">//由于配置了多的一方到一的一方的关联关系（当保存的时候，就已经对外键赋值）</span></span><br><span class="line">    customer.getLinkMans().add(linkMan);<span class="comment">//由于配置了一的一方到多的一方的关联关系（发送一条update语句）</span></span><br><span class="line">    customerDao.save(customer);</span><br><span class="line">    linkManDao.save(linkMan);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过保存的案例，我们可以发现在设置了双向关系之后，会发送两条insert语句，一条多余的update语句，那我们的解决是思路很简单，就是一的一方放弃维护权, 放弃外键维护权的配置将如下配置改为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 放弃外键维护权</span></span><br><span class="line"><span class="comment">    *      mappedBy：对方配置关系的属性名称</span></span><br><span class="line"><span class="comment">    *      cascade : 配置级联（可以配置到设置多表的映射关系的注解上）</span></span><br><span class="line"><span class="comment">    *      CascadeType.all         : 所有</span></span><br><span class="line"><span class="comment">    *                  MERGE       ：更新</span></span><br><span class="line"><span class="comment">    *                  PERSIST     ：保存</span></span><br><span class="line"><span class="comment">    *                  REMOVE      ：删除</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * fetch : 配置关联对象的加载方式</span></span><br><span class="line"><span class="comment">    *          EAGER   ：立即加载</span></span><br><span class="line"><span class="comment">    *          LAZY    ：延迟加载</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@OneToMany</span>(mappedBy = <span class="string">"customer"</span>,cascade = CascadeType.ALL)</span><br></pre></td></tr></table></figure>
<h2 id="7-5-2-删除"><a href="#7-5-2-删除" class="headerlink" title="7.5.2    删除"></a>7.5.2    删除</h2><p>删除操作的说明如下：<br><strong>删除从表数据：可以随时任意删除。</strong><br><strong>删除主表数据：</strong></p>
<ul>
<li>有从表数据<br>1、在默认情况下，它会把外键字段置为null，然后删除主表数据。如果在数据库的表结构上，外键字段有非空约束，默认情况就会报错了。<br>2、如果配置了放弃维护关联关系的权利，则不能删除（与外键字段是否允许为null，没有关系）因为在删除时，它根本不会去更新从表的外键字段了。<br>3、如果还想删除，使用级联删除引用</li>
<li>没有从表数据引用：随便删</li>
</ul>
<p><code>在实际开发中，级联删除请慎用！(在一对多的情况下)</code></p>
<h2 id="7-5-3-级联操作"><a href="#7-5-3-级联操作" class="headerlink" title="7.5.3    级联操作"></a>7.5.3    级联操作</h2><p>级联操作：指操作一个对象同时操作它的关联对象<br>级联操作:</p>
<blockquote>
<p>1.需要区分操作主体<br>2.需要在操作主体的实体类上，添加级联属性（需要添加到多表映射关系的注解上）<br><code>使用方法：只需要在操作主体的注解上配置cascade</code></p>
</blockquote>
<p><strong>级联添加：保存一个客户的同时，保存客户的所有联系人</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 级联添加：保存一个客户的同时，保存客户的所有联系人</span></span><br><span class="line"><span class="comment">    *      需要在操作主体的实体类上，配置casacde属性</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line">   <span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCascadeAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//创建客户对象</span></span><br><span class="line">       Customer customer=<span class="keyword">new</span> Customer();</span><br><span class="line">       customer.setCustName(<span class="string">"java1"</span>);</span><br><span class="line">       <span class="comment">//创建联系人对象</span></span><br><span class="line">       LinkMan linkMan=<span class="keyword">new</span> LinkMan();</span><br><span class="line">       linkMan.setLkmName(<span class="string">"Spring1"</span>);</span><br><span class="line"></span><br><span class="line">       linkMan.setCustomer(customer);</span><br><span class="line">       customer.getLinkManSet().add(linkMan);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//这里只保存了客户，联系人会根据级联关系自动保存</span></span><br><span class="line">       customerDao.save(customer);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>同时，还需要在Customer实体，多表映射注解中添加<code>cascade</code>属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**        （可以配置到设置多表的映射关系的注解上）</span></span><br><span class="line"><span class="comment"> *         CascadeType.all      : 所有</span></span><br><span class="line"><span class="comment"> *                  MERGE       ：更新</span></span><br><span class="line"><span class="comment"> *                  PERSIST     ：保存</span></span><br><span class="line"><span class="comment"> *                  REMOVE      ：删除</span></span><br><span class="line"><span class="comment"> *         推荐配置成：CascadeType.ALL</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@OneToMany</span>(mappedBy = <span class="string">"customer"</span>,cascade = CascadeType.ALL)</span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkManSet=<span class="keyword">new</span> HashSet&lt;LinkMan&gt;();</span><br></pre></td></tr></table></figure>

<p><strong>级联删除：删除一个客户的同时，删除客户的所有联系人</strong><br>需要先把注入jpa配置的<code>create</code>改成<code>update</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注入jpa的配置信息</span></span><br><span class="line"><span class="comment">            加载jpa的基本配置信息和jpa实现方式（hibernate）的配置信息</span></span><br><span class="line"><span class="comment">            hibernate.hbm2ddl.auto : 自动创建数据库表</span></span><br><span class="line"><span class="comment">                create ： 每次都会重新创建数据库表</span></span><br><span class="line"><span class="comment">                update：有表不会重新创建，没有表会重新创建表</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jpaProperties"</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 级联删除：</span></span><br><span class="line"><span class="comment">    *      删除1号客户的同时，删除1号客户的所有联系人</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="meta">@Transactional</span> <span class="comment">//配置事务</span></span><br><span class="line">   <span class="meta">@Rollback</span>(<span class="keyword">false</span>) <span class="comment">//不自动回滚</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCascadeRemove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//1。查询1号客户</span></span><br><span class="line">       customerDao.findOne(<span class="number">1L</span>);</span><br><span class="line">       <span class="comment">//2.删除1号客户</span></span><br><span class="line">       customerDao.delete(<span class="number">1L</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h1 id="第8章-JPA中的多对多"><a href="#第8章-JPA中的多对多" class="headerlink" title="第8章    JPA中的多对多"></a>第8章    JPA中的多对多</h1><h2 id="8-1-示例分析"><a href="#8-1-示例分析" class="headerlink" title="8.1    示例分析"></a>8.1    示例分析</h2><p>我们采用的示例为用户和角色。</p>
<p> 用户：指的是咱们班的每一个同学。</p>
<p> 角色：指的是咱们班同学的身份信息。</p>
<p> 比如A同学，它是我的学生，其中有个身份就是学生，还是家里的孩子，那么他还有个身份是子女。</p>
<p> 同时B同学，它也具有学生和子女的身份。</p>
<p> 那么任何一个同学都可能具有多个身份。同时学生这个身份可以被多个同学所具有。</p>
<p> 所以我们说，用户和角色之间的关系是多对多。</p>
<h2 id="8-2-表关系建立"><a href="#8-2-表关系建立" class="headerlink" title="8.2    表关系建立"></a>8.2    表关系建立</h2><p> 多对多的表关系建立靠的是中间表，其中用户表和中间表的关系是一对多，角色表和中间表的关系也是一对多，如下图所示：<br><img alt data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/8.2.jpg" class="lazyload"></p>
<h2 id="8-3-实体类关系建立以及映射配置"><a href="#8-3-实体类关系建立以及映射配置" class="headerlink" title="8.3    实体类关系建立以及映射配置"></a>8.3    实体类关系建立以及映射配置</h2><p>一个用户可以具有多个角色，所以在用户实体类中应该包含多个角色的信息，代码如下：</p>
<p>未完，待补充</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">LiuYu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.liuyu.pw/posts/cdeb19ab.html">https://www.liuyu.pw/posts/cdeb19ab.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.liuyu.pw">LiuYuBLOG</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringDataJpa/">SpringDataJpa    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringDataJpa/springdatajpa.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/1f9a4005.html"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/Oracle入门/oracle.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Oracle把查询结果插入到表中几种方式</span></div></a></div><div class="next-post pull_right"><a href="/posts/9f698189.html"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/Oracle入门/oracle.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Oracle入门</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/33bbdc1c.html" title="SpringJpa入门"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/liuyu1994/Picture/hexo/Butterflys/post/SpringJpa/spring.jpg"><div class="relatedPosts_title">SpringJpa入门</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'VbgpG0JUI1VviQCA8A4dvjzH-gzGzoHsz',
  appKey:'3LI5Ic5nDyKgC2bVCFOgvjF2',
  placeholder:'有爱的评论，说点好听的~',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></div><footer id="footer"><div id="footer-wrap"><div class="copyright">Copyright &copy;2017 - 2019  LiuYu BLOG</div><div class="framework-info"><span>Power by </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script async src="/js/search/algolia.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/ClickShowText.js"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>